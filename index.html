<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Doors of Stone - A Fan-Fiction Outline</title>
    <style>
        :root {
            --primary: #8b4513;
            --secondary: #2c1810;
            --accent: #d4af37;
            --bg: #1a1a1a;
            --text: #e8e8e8;
            --muted: #888;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.8;
        }
        .hero {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--bg) 100%);
            padding: 60px 20px;
            text-align: center;
            border-bottom: 2px solid var(--accent);
        }
        .hero h1 {
            font-size: 2.5em;
            color: var(--accent);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 10px;
        }
        .hero .subtitle {
            font-style: italic;
            color: var(--muted);
            font-size: 1.1em;
            margin-bottom: 20px;
        }
        .hero .quote {
            max-width: 600px;
            margin: 0 auto;
            padding: 15px;
            font-style: italic;
            border-left: 3px solid var(--accent);
            background: rgba(0,0,0,0.3);
            font-size: 0.95em;
        }
        .container { max-width: 1100px; margin: 0 auto; padding: 30px 20px; }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab {
            padding: 10px 20px;
            background: var(--secondary);
            border: 1px solid transparent;
            color: var(--text);
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
        }
        .tab:hover, .tab.active {
            border-color: var(--accent);
            color: var(--accent);
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .nav {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }
        .nav a {
            display: block;
            padding: 15px;
            background: var(--secondary);
            color: var(--text);
            text-decoration: none;
            border-radius: 8px;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid transparent;
            font-size: 0.9em;
        }
        .nav a:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }
        .nav a .icon { font-size: 1.5em; display: block; margin-bottom: 8px; }
        
        section { margin-bottom: 40px; }
        h2 {
            color: var(--accent);
            font-size: 1.5em;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--primary);
        }
        h3 { color: var(--accent); margin: 15px 0 10px; }
        p { margin-bottom: 12px; }
        .highlight {
            background: var(--secondary);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--accent);
            margin: 15px 0;
        }
        .highlight p { margin: 0; font-style: italic; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; font-size: 0.9em; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid var(--primary); }
        th { background: var(--secondary); color: var(--accent); }
        .warning {
            background: rgba(139, 69, 19, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 0.9em;
        }
        .warning strong { color: var(--accent); }
        ul { padding-left: 20px; margin: 12px 0; }
        li { margin: 6px 0; }
        .footer {
            text-align: center;
            padding: 30px 20px;
            background: var(--secondary);
            color: var(--muted);
            margin-top: 40px;
            font-size: 0.9em;
        }
        a { color: var(--accent); }
        
        /* Graph Visualization */
        #graph-container {
            width: 100%;
            height: 500px;
            background: var(--secondary);
            border-radius: 8px;
            margin: 20px 0;
            position: relative;
        }
        #graph { width: 100%; height: 100%; }
        .legend {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(26, 26, 26, 0.9);
            padding: 10px;
            border-radius: 5px;
            font-size: 0.8em;
        }
        .legend-item { display: flex; align-items: center; margin: 4px 0; }
        .legend-color { width: 15px; height: 15px; margin-right: 8px; border-radius: 3px; }
        .tooltip {
            position: absolute;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            border-radius: 4px;
            font-size: 0.85em;
            pointer-events: none;
            max-width: 250px;
            z-index: 1000;
            border: 1px solid var(--accent);
        }
        
        .chapter-preview {
            background: var(--secondary);
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .chapter-preview p { font-style: italic; font-size: 0.95em; }
        
        .structure-tree {
            background: var(--secondary);
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.85em;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="hero">
        <h1>ğŸ—ï¸ The Doors of Stone</h1>
        <p class="subtitle">A Fan-Fiction Outline for Book 3 of Patrick Rothfuss's Kingkiller Chronicle</p>
        <div class="quote">
            "There are three things all wise men fear: the sea in storm, a night with no moon, and the anger of a gentle man."
        </div>
    </div>

    <div class="container">
        <div class="tabs">
            <div class="tab active" data-tab="overview">ğŸ“– Overview</div>
            <div class="tab" data-tab="graph">ğŸ•¸ï¸ Story Graph</div>
            <div class="tab" data-tab="outline">ğŸ“‹ Outline</div>
            <div class="tab" data-tab="characters">ğŸ‘¥ Characters</div>
            <div class="tab" data-tab="scenes">ğŸ¬ Scenes</div>
        </div>

        <!-- OVERVIEW TAB -->
        <div id="overview" class="tab-content active">
            <section>
                <h2>About This Project</h2>
                <p>This is a <strong>fan-fiction outline</strong> for the long-awaited third book of Patrick Rothfuss's <em>Kingkiller Chronicle</em> series, created using the <strong>Snowflake Method</strong>.</p>
                
                <div class="warning">
                    <strong>âš ï¸ Disclaimer:</strong> This is fan fictionâ€”a creative exercise, not a prediction. All rights belong to Patrick Rothfuss.
                </div>
            </section>

            <section>
                <h2>ğŸŒŸ The Core Story</h2>
                <div class="highlight">
                    <p>A legendary arcanist's obsessive hunt for the demons who murdered his family leads him to open a forbidden door, killing a king and unleashing a catastrophe that destroys everything he lovesâ€”including himself.</p>
                </div>
            </section>

            <section>
                <h2>â“ Mysteries Resolved</h2>
                <table>
                    <tr><th>Mystery</th><th>Resolution</th></tr>
                    <tr><td><strong>Denna's Patron</strong></td><td>Cinderâ€”using her for Chandrian propaganda</td></tr>
                    <tr><td><strong>The King Killed</strong></td><td>Roderic Calanthisâ€”manipulated by Chandrian</td></tr>
                    <tr><td><strong>The Doors of Stone</strong></td><td>Prison from Creation War; opening causes catastrophe</td></tr>
                    <tr><td><strong>The Amyr</strong></td><td>Hidden antagonists who see Kvothe as threat</td></tr>
                    <tr><td><strong>Kvothe's Lost Power</strong></td><td>He locked away his own true name</td></tr>
                    <tr><td><strong>The Thrice-Locked Chest</strong></td><td>Contains his name, sword Caesura, and the key</td></tr>
                </table>
            </section>

            <section>
                <h2>âœï¸ Chapter One Preview</h2>
                <div class="chapter-preview">
                    <p>"It was the third day, and the silence had changed.</p>
                    <p>The Waystone Inn lay quiet as a patient dying, its common room holding the dim light of late morning like a cupped hand holds waterâ€”carelessly, letting it slip through the cracks..."</p>
                    <p style="text-align: right; margin-top: 15px;">
                        <a href="./chapters/chapter-01.md">Read Full Chapter â†’</a>
                    </p>
                </div>
            </section>

            <section>
                <h2>ğŸ“‚ Project Structure</h2>
                <div class="structure-tree">
kingkiller-book3/
â”œâ”€â”€ b_markdown_data/
â”‚   â”œâ”€â”€ 1 sentence summary.md
â”‚   â”œâ”€â”€ 1 paragraph summary.md
â”‚   â”œâ”€â”€ character_profiles/
â”‚   â”‚   â”œâ”€â”€ Kvothe.md
â”‚   â”‚   â””â”€â”€ Denna.md
â”‚   â””â”€â”€ scenes/
â”‚       â”œâ”€â”€ 01_The_Third_Day.md
â”‚       â”œâ”€â”€ 11_The_Amyr_Revealed.md
â”‚       â”œâ”€â”€ 36_The_Confrontation_With_Denna.md
â”‚       â””â”€â”€ ...
â”œâ”€â”€ c_graph_data/
â”‚   â””â”€â”€ knowledge_graph.json
â”œâ”€â”€ outline/           (Snowflake Method docs)
â”œâ”€â”€ characters/        (Legacy character files)
â”œâ”€â”€ chapters/
â”‚   â””â”€â”€ chapter-01.md
â””â”€â”€ unresolved-threads.md
                </div>
            </section>
        </div>

        <!-- GRAPH TAB -->
        <div id="graph" class="tab-content">
            <section>
                <h2>ğŸ•¸ï¸ Story Knowledge Graph</h2>
                <p>Interactive visualization of how plot elements, characters, and scenes connect.</p>
                <div id="graph-container">
                    <div id="graph-viz"></div>
                    <div class="legend">
                        <div class="legend-item"><div class="legend-color" style="background: #e41a1c;"></div>Synopsis</div>
                        <div class="legend-item"><div class="legend-color" style="background: #984ea3;"></div>Character</div>
                        <div class="legend-item"><div class="legend-color" style="background: #ff7f00;"></div>Scene</div>
                        <div class="legend-item"><div class="legend-color" style="background: #4daf4a;"></div>Mystery</div>
                    </div>
                </div>
                <div class="tooltip" style="display: none;"></div>
            </section>
        </div>

        <!-- OUTLINE TAB -->
        <div id="outline" class="tab-content">
            <section>
                <h2>â„ï¸ Snowflake Method Outline</h2>
                <nav class="nav">
                    <a href="./outline/01-one-sentence-summary.md"><span class="icon">1ï¸âƒ£</span>One-Sentence</a>
                    <a href="./outline/02-one-paragraph-summary.md"><span class="icon">ğŸ“</span>One-Paragraph</a>
                    <a href="./outline/03-character-summaries.md"><span class="icon">ğŸ‘¤</span>Char Summaries</a>
                    <a href="./outline/04-one-page-synopsis.md"><span class="icon">ğŸ“„</span>One-Page</a>
                    <a href="./outline/05-character-synopses.md"><span class="icon">ğŸ“–</span>Char Synopses</a>
                    <a href="./outline/06-four-page-synopsis.md"><span class="icon">ğŸ“š</span>Four-Page</a>
                    <a href="./outline/07-character-charts.md"><span class="icon">ğŸ“Š</span>Char Charts</a>
                    <a href="./outline/08-scene-list.md"><span class="icon">ğŸ“‹</span>Scene List</a>
                </nav>
            </section>
            
            <section>
                <h2>ğŸ“‹ The Three Disasters</h2>
                <table>
                    <tr><th>Disaster</th><th>Event</th><th>Cause</th></tr>
                    <tr><td><strong>1 (Act 1 End)</strong></td><td>The Amyr reveal themselves as antagonists</td><td>External</td></tr>
                    <tr><td><strong>2 (Midpoint)</strong></td><td>Denna chooses her patron over Kvothe</td><td>Kvothe's actions</td></tr>
                    <tr><td><strong>3 (Act 2 End)</strong></td><td>Opening the Doors; killing the king</td><td>Kvothe's actions</td></tr>
                </table>
            </section>
        </div>

        <!-- CHARACTERS TAB -->
        <div id="characters" class="tab-content">
            <section>
                <h2>ğŸ‘¥ Character Profiles</h2>
                <nav class="nav">
                    <a href="./b_markdown_data/character_profiles/Kvothe.md"><span class="icon">ğŸ”¥</span>Kvothe</a>
                    <a href="./b_markdown_data/character_profiles/Denna.md"><span class="icon">ğŸŒ™</span>Denna</a>
                    <a href="./characters/kvothe.md"><span class="icon">ğŸ“œ</span>Kvothe (Legacy)</a>
                    <a href="./characters/denna.md"><span class="icon">ğŸ“œ</span>Denna (Legacy)</a>
                </nav>
            </section>
            
            <section>
                <h2>Character Arcs Summary</h2>
                <table>
                    <tr><th>Character</th><th>Want</th><th>Flaw</th><th>Epiphany</th></tr>
                    <tr><td><strong>Kvothe</strong></td><td>Destroy Chandrian</td><td>Certainty/Arrogance</td><td>He was the weapon all along</td></tr>
                    <tr><td><strong>Denna</strong></td><td>Freedom/Power</td><td>Can't accept help</td><td>Independence isn't always strength</td></tr>
                    <tr><td><strong>Bast</strong></td><td>Restore Kvothe</td><td>Doesn't understand humans</td><td>Some stories shouldn't have happy endings</td></tr>
                </table>
            </section>
        </div>

        <!-- SCENES TAB -->
        <div id="scenes" class="tab-content">
            <section>
                <h2>ğŸ¬ Key Scenes</h2>
                <nav class="nav">
                    <a href="./b_markdown_data/scenes/01_The_Third_Day.md"><span class="icon">ğŸŒ…</span>The Third Day</a>
                    <a href="./b_markdown_data/scenes/02_Return_to_University.md"><span class="icon">ğŸ›ï¸</span>Return to University</a>
                    <a href="./b_markdown_data/scenes/11_The_Amyr_Revealed.md"><span class="icon">âš”ï¸</span>Amyr Revealed</a>
                    <a href="./b_markdown_data/scenes/36_The_Confrontation_With_Denna.md"><span class="icon">ğŸ’”</span>Confrontation</a>
                    <a href="./b_markdown_data/scenes/70_The_Door_Opens.md"><span class="icon">ğŸšª</span>The Door Opens</a>
                    <a href="./b_markdown_data/scenes/91_The_Kingkiller.md"><span class="icon">ğŸ‘‘</span>The Kingkiller</a>
                    <a href="./b_markdown_data/scenes/106_The_Locking.md"><span class="icon">ğŸ”’</span>The Locking</a>
                </nav>
            </section>
            
            <section>
                <h2>Story Structure</h2>
                <table>
                    <tr><th>Part</th><th>Chapters</th><th>Pages</th><th>Focus</th></tr>
                    <tr><td>Frame Opening</td><td>1-2</td><td>~12</td><td>Third day begins</td></tr>
                    <tr><td>Part 1: The Return</td><td>3-25</td><td>~130</td><td>University, Amyr revelation</td></tr>
                    <tr><td>Part 2: The Patron</td><td>26-50</td><td>~125</td><td>Denna's patron, confrontation</td></tr>
                    <tr><td>Part 3: The Door</td><td>51-75</td><td>~110</td><td>Lackless heritage, pursuit</td></tr>
                    <tr><td>Part 4: The Opening</td><td>76-100</td><td>~110</td><td>Battle, catastrophe, kingkilling</td></tr>
                    <tr><td>Part 5: The Silence</td><td>101-120</td><td>~75</td><td>Locking, becoming Kote</td></tr>
                    <tr><td>Frame End</td><td>Epilogue</td><td>~23</td><td>The choice</td></tr>
                </table>
            </section>
        </div>
    </div>

    <div class="footer">
        <p><em>"You may have heard of me."</em></p>
        <p>Created with respect for Patrick Rothfuss's work. All rights to original material belong to him.</p>
        <p style="margin-top: 15px;">
            <a href="https://github.com/belindamo/kingkiller-book3">View on GitHub</a> â€¢ 
            <a href="./unresolved-threads.md">All Mysteries</a> â€¢ 
            <a href="./chapters/chapter-01.md">Read Chapter 1</a>
        </p>
    </div>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
                
                if (tab.dataset.tab === 'graph') initGraph();
            });
        });

        // Knowledge Graph Visualization
        function initGraph() {
            const container = document.getElementById('graph-viz');
            if (container.hasChildNodes()) return;
            
            const width = container.parentElement.clientWidth;
            const height = 480;

            const nodeColors = {
                'OneSentenceSynopsis': '#e41a1c',
                'OneParagraphSynopsis': '#e41a1c',
                'FourPageSynopsis': '#e41a1c',
                'CharacterProfile': '#984ea3',
                'Scene': '#ff7f00',
                'UnresolvedThread': '#4daf4a'
            };

            fetch('c_graph_data/knowledge_graph.json')
                .then(r => r.json())
                .then(data => {
                    const svg = d3.select('#graph-viz')
                        .append('svg')
                        .attr('width', width)
                        .attr('height', height);

                    const simulation = d3.forceSimulation(data.nodes)
                        .force('link', d3.forceLink(data.edges).id(d => d.id).distance(80))
                        .force('charge', d3.forceManyBody().strength(-200))
                        .force('center', d3.forceCenter(width / 2, height / 2));

                    const link = svg.append('g')
                        .selectAll('line')
                        .data(data.edges)
                        .join('line')
                        .attr('stroke', '#666')
                        .attr('stroke-opacity', 0.4);

                    const node = svg.append('g')
                        .selectAll('circle')
                        .data(data.nodes)
                        .join('circle')
                        .attr('r', d => d.type.includes('Synopsis') ? 12 : 8)
                        .attr('fill', d => nodeColors[d.type] || '#999')
                        .call(d3.drag()
                            .on('start', dragstarted)
                            .on('drag', dragged)
                            .on('end', dragended));

                    const tooltip = d3.select('.tooltip');
                    
                    node.on('mouseover', (event, d) => {
                        tooltip.style('display', 'block')
                            .html(`<strong>${d.name}</strong><br><em>${d.type}</em><br>${d.content || ''}`)
                            .style('left', (event.pageX + 10) + 'px')
                            .style('top', (event.pageY - 10) + 'px');
                    }).on('mouseout', () => tooltip.style('display', 'none'));

                    const label = svg.append('g')
                        .selectAll('text')
                        .data(data.nodes)
                        .join('text')
                        .text(d => d.name.length > 15 ? d.name.slice(0,12) + '...' : d.name)
                        .attr('font-size', '9px')
                        .attr('fill', '#ccc')
                        .attr('dx', 12)
                        .attr('dy', 4);

                    simulation.on('tick', () => {
                        link.attr('x1', d => d.source.x).attr('y1', d => d.source.y)
                            .attr('x2', d => d.target.x).attr('y2', d => d.target.y);
                        node.attr('cx', d => d.x).attr('cy', d => d.y);
                        label.attr('x', d => d.x).attr('y', d => d.y);
                    });

                    function dragstarted(event) {
                        if (!event.active) simulation.alphaTarget(0.3).restart();
                        event.subject.fx = event.subject.x;
                        event.subject.fy = event.subject.y;
                    }
                    function dragged(event) {
                        event.subject.fx = event.x;
                        event.subject.fy = event.y;
                    }
                    function dragended(event) {
                        if (!event.active) simulation.alphaTarget(0);
                        event.subject.fx = null;
                        event.subject.fy = null;
                    }
                })
                .catch(e => {
                    container.innerHTML = '<p style="padding:20px;color:#888;">Graph data not available. <a href="c_graph_data/knowledge_graph.json">View JSON</a></p>';
                });
        }
    </script>
</body>
</html>